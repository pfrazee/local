function noop(){}(function(){function e(e){return e&&"function"==typeof e.then}function t(e){this.succeedCBs=[],this.failCBs=[],this.__hasValue=!1,this.__hasFailed=!1,this.value=void 0,e&&this.fulfill(e)}function r(t,r,n){if(null===n)t.isRejected()?r.reject(t.value):r.fulfill(t.value);else{var o;try{o=n(t.value)}catch(i){console.error?console.error("Promise exception thrown",i,'("'+(""+i)+'")'):console.log("Promise exception thrown",i,'("'+(""+i)+'")'),r.reject(i)}e(o)?a(o).chain(r):r.fulfill(o)}}function n(e){return function(t,r){return t?e.reject(t):e.fulfill(r===void 0?null:r)}}function o(e,t){Array.isArray(e)||(e=[e]);var r=a(),n=e.length,o=0;if(0===n)return r.fulfill([]),r;var i=[];i.length=n;for(var s=[],u=function(e,a,u){i[a]=e,u&&s.push(a),++o==n&&(t?t(i,s)?r.fulfill(i):r.reject(i):r.fulfill(i))},l=0;n>l;l++)a(e[l]).succeed(u,l,!1).fail(u,l,!0);return r}function i(e){return o(e,function(e,t){return 0===t.length})}function s(e){return o(e,function(e,t){return t.length<e.length})}function a(r){if(arguments.length>1)return o(Array.prototype.slice.call(arguments));if(r instanceof t)return r;if(e(r)){var n=a();return r.then(function(e){n.fulfill(e)},function(e){n.reject(e)}),n}return new t(r)}var u=this;"undefined"!=typeof window?(window.Local===void 0&&(window.Local={}),u=window.Local):"undefined"!=typeof self?(self.Local===void 0&&(self.Local={}),u=self.Local):"undefined"!=typeof module&&(u=module.exports),t.prototype.isUnfulfilled=function(){return!this.__hasValue},t.prototype.isRejected=function(){return this.__hasFailed},t.prototype.isFulfilled=function(){return this.__hasValue&&!this.__hasFailed},t.prototype.then=function(e,t){e=e&&"function"==typeof e?e:null,t=t&&"function"==typeof t?t:null;var n=a();if(this.isUnfulfilled())this.succeedCBs.push({p:n,fn:e}),this.failCBs.push({p:n,fn:t});else{var o=this;setTimeout(function(){o.isFulfilled()?r(o,n,e):r(o,n,t)},0)}return n},t.prototype.succeed=function(e){if(this.isRejected())return this;var t=Array.prototype.slice.call(arguments,1);return this.then(function(r){return e.apply(null,[r].concat(t))})},t.prototype.fail=function(e){if(this.isFulfilled())return this;var t=Array.prototype.slice.call(arguments,1);return this.then(null,function(r){return e.apply(null,[r].concat(t))})},t.prototype.fulfill=function(e){if(this.isUnfulfilled()){this.value=e,this.__hasValue=!0;for(var t=0;this.succeedCBs.length>t;t++){var n=this.succeedCBs[t];r(this,n.p,n.fn)}this.succeedCBs.length=0,this.failCBs.length=0}return this},t.prototype.reject=function(e){if(this.isUnfulfilled()){this.value=e,this.__hasValue=!0,this.__hasFailed=!0;for(var t=0;this.failCBs.length>t;t++){var n=this.failCBs[t];r(this,n.p,n.fn)}this.succeedCBs.length=0,this.failCBs.length=0}return this},t.prototype.cancel=function(){var e;for(e=0;this.succeedCBs.length>e;e++)this.succeedCBs[e].p.cancel();for(e=0;this.failCBs.length>e;e++)this.failCBs[e].p.cancel();return this.succeedCBs.length=0,this.failCBs.length=0,this},t.prototype.chain=function(e){return this.then(function(t){return a(e).fulfill(t),t},function(t){return a(e).reject(t),t}),e},u.Promise=t,u.promise=a,u.promise.bundle=o,u.promise.all=i,u.promise.any=s,u.nodeStyleCB=n})(),"undefined"!=typeof define&&define([],function(){return Promise});var Link={};(function(e){function t(){this._events={}}function r(e){if(e&&"object"==typeof e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}function n(e){return e instanceof r?e:new r(e)}function o(e,t){if(!e||"object"!=typeof e||!t)return e;var r=u(t,"serializer");return r?r(e):e}function i(e,t){if(!e||"string"!=typeof e||!t)return e;var r=u(t,"deserializer");return r?r(e):e}function s(e,t,r){c[e]={serializer:t,deserializer:r}}function a(e){var t=e.split(";"),r=t[0];if(t=r.split("/"),t[1]){var n=t[1].split("+");return n[1]?[r,t[0]+"/"+n[1],t[0]]:[r,t[0]]}return[r]}function u(e,t){for(var r=a(e),n=0;r.length>n;n++)if(r[n]in c)return c[r[n]][t];return null}t.prototype.emit=function(e){var t=this._events[e];if(!t)return!1;for(var r=Array.prototype.slice.call(arguments,1),n=0,o=t.length;o>n;n++)t[n].apply(this,r);return!0},t.prototype.addListener=function(e,t){if(Array.isArray(e))return e.forEach(function(e){this.addListener(e,t)},this),void 0;if("function"!=typeof t)throw Error("addListener only takes instances of Function");return this.emit("newListener",e,t),this._events[e]?this._events[e].push(t):this._events[e]=[t],this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){var r=this;r.on(e,function n(){r.removeListener(e,n),t.apply(this,arguments)})},t.prototype.removeListener=function(e,t){if("function"!=typeof t)throw Error("removeListener only takes instances of Function");if(!this._events[e])return this;var r=this._events[e],n=r.indexOf(t);return 0>n?this:(r.splice(n,1),0===r.length&&delete this._events[e],this)},t.prototype.removeAllListeners=function(e){return e&&this._events[e]&&(this._events[e]=null),this},t.prototype.listeners=function(e){return this._events[e]},e.EventEmitter=t,r.prototype.addLink=function(e,t,r){var n=r||{};return n.href=e,n.rel=t,this.link||(this.link=[]),this.link.push(n),this},r.prototype.setAuth=function(e){return this.authorization=e,this},r.prototype.serialize=function(){if(this.link&&Array.isArray(this.link))throw"Link header serialization is not yet implemented";if(this.authorization&&"object"==typeof this.authorization){if(!this.authorization.scheme)throw"`scheme` required for auth headers";var e;switch(this.authorization.scheme.toLowerCase()){case"basic":e="Basic "+btoa(this.authorization.name+":"+this.authorization.password);break;case"persona":e="Persona name="+this.authorization.name+" assertion="+this.authorization.assertion;break;default:throw"unknown auth sceme: "+this.authorization.scheme}this.authorization=e}return this},e.Headerer=r,e.headerer=n,e.parseLinkHeader=function(e){return"string"!=typeof e?e:e.replace(/,[\s]*</g,"|||<").split("|||").map(function(e){var t={};return e.trim().split(";").forEach(function(e){if(e=e.trim())if("<"===e.charAt(0))t.href=e.trim().slice(1,-1);else{var r=e.split("="),n=r[0].trim(),o=r[1].trim().slice(1,-1);t[n]=o}}),t})},e.lookupLink=function(e,t,r){var n=e?e.length:0;if(!n)return null;r=r.toLowerCase();for(var o=null,i=0;n>i;i++){var s=e[i];if(s&&s.rel&&-1!==s.rel.indexOf(t))if(s.title){if(s.title.toLowerCase()===r){o=s;break}}else o=s}return o?o.href:null},e.joinUrl=function(){var e=Array.prototype.map.call(arguments,function(e){var t=0,r=e.length;return"/"===e.charAt(0)&&(t+=1),"/"===e.charAt(r-1)&&(r-=1),e.substring(t,r)});return e.join("/")},e.parseUri=function(t){"object"==typeof t&&(t.url?t=t.url:(t.host||t.path)&&(t=Link.joinUrl(req.host,req.path)));for(var r=e.parseUri.options,n=r.parser[r.strictMode?"strict":"loose"].exec(t),o={},i=14;i--;)o[r.key[i]]=n[i]||"";return o[r.q.name]={},o[r.key[12]].replace(r.q.parser,function(e,t,n){t&&(o[r.q.name][t]=n)}),o},e.parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var l={serialize:o,deserialize:i,register:s},c={};s("application/json",function(e){try{return JSON.stringify(e)}catch(t){return t.message}},function(e){try{return JSON.parse(e)}catch(t){return t.message}}),s("application/x-www-form-urlencoded",function(e){var t=encodeURIComponent,r=[];for(var n in e)if(null===e[n])r.push(n+"=");else if(Array.isArray(e[n]))for(var o=0;e[n].length>o;o++)r.push(n+"[]="+t(e[n][o]));else if("object"==typeof e[n])for(var i in e[n])r.push(n+"["+i+"]="+t(e[n][i]));else r.push(n+"="+t(e[n]));return r.join("&")},function(e){for(var t=e.split("&"),r={},n=0;t.length>n;n++){var o=t[n].split("="),i=decodeURIComponent(o[0]),s=decodeURIComponent(o[1]),a=/\[\]$/.test(i),u=i.match(/^(.+)\[([^\]]+)\]$/);if(u){i=u[1];var l=u[2];r[i]=r[i]||{},r[i][l]=s}else a?(i=i.substring(0,i.length-2),r[i]=r[i]||[],r[i].push(s)):r[i]=s}return r}),e.contentTypes=l})(Link),function(e){function t(e){e=e||{},e.headers=e.readers||{},this.message=""+e.status+": "+e.reason,this.response=e}function r(e){if(!e)throw"no req param provided to request";if(e.headers=e.headers||{},e.query=e.query||{},m)return m(e);if(e.urld=e.url?Link.parseUri(e.url):Link.parseUri(Link.joinUrl(e.host,e.path)),!e.urld)throw"no URL or host/path provided in request";e.urld.protocol||(e.url=e.url.length>0&&"/"!=e.url.charAt(0)?window.location.protocol+"//"+window.location.host+v+e.url:window.location.protocol+"//"+window.location.host+e.url,e.urld=Link.parseUri(e.url));var r=Local.promise();return"httpl"==e.urld.protocol?setTimeout(function(){n(e,r)},0):"http"==e.urld.protocol||"https"==e.urld.protocol?setTimeout(function(){o(e,r)},0):r.fulfill(new t({status:0,reason:'unsupported protocol "'+e.urld.protocol+'"'})),r}function n(e,r){var n=d[e.urld.host];if(!n){var o=new u(404,"server not found");return r.reject(new t(o)),o.end(),void 0}var i={path:e.urld.path,method:e.method,query:e.query||{},headers:e.headers||{},body:e.body,stream:e.stream};if(e.urld.query){var s=Link.contentTypes.deserialize(e.urld.query,"application/x-www-form-urlencoded");for(var a in s)i.query[a]=s[a]}n.fn.call(n.context,i,new l(r,e.stream))}function o(e,t){if(e.query){var r=Link.contentTypes.serialize(e.query,"application/x-www-form-urlencoded");r&&(e.urld.query?(e.urld.query+="&"+r,e.urld.relative+="&"+r):(e.urld.query=r,e.urld.relative+="?"+r))}"undefined"!=typeof window?i(e,t):s(e,t)}function i(e,r){var n=(e.urld.protocol?e.urld.protocol+"://":"")+e.urld.authority+e.urld.relative;e.headers=Link.headerer(e.headers).serialize(),null!==e.body&&e.body!==void 0&&(e.headers["content-type"]=e.headers["content-type"]||"application/json","string"!=typeof e.body&&(e.body=Link.contentTypes.serialize(e.body,e.headers["content-type"])));var o=new XMLHttpRequest;o.open(e.method,n,!0);for(var i in e.headers)null!==e.headers[i]&&e.headers.hasOwnProperty(i)&&o.setRequestHeader(i,e.headers[i]);var s,a=0,l=0;o.onreadystatechange=function(){if(o.readyState>=XMLHttpRequest.HEADERS_RECEIVED&&!s&&(s=new u(o.status,o.statusText),o.getAllResponseHeaders().split("\n").forEach(function(e){if(e){var t=e.toLowerCase().replace("\r","").split(": ");s.headers[t[0]]=t[1]}}),s.headers.link&&(s.headers.link=Link.parseLinkHeader(s.headers.link)),e.stream&&(s.status>=200&&400>s.status?r.fulfill(s):s.status>=400&&600>s.status?r.reject(new t(s)):0===s.status?r.reject(new t({code:0,reason:"Remote connection refused by the host"})):r.reject(new t(s)),a=setInterval(function(){var e=o.responseText.length;e>l&&(l=e,s.write(o.responseText,!0))},e.streamPoll||500))),o.readyState===XMLHttpRequest.DONE){s=s||new u(o.status,o.statusText),a&&clearInterval(a);var n=Link.contentTypes.deserialize(o.responseText,s.headers["content-type"]);e.stream?s.write(n):(s.body=Link.contentTypes.deserialize(o.responseText,s.headers["content-type"]),s.status>=200&&400>s.status?r.fulfill(s):s.status>=400&&600>s.status?r.reject(new t(s)):0===s.status?r.reject(new t({code:0,reason:"Remote connection refused by the host"})):r.reject(new t(s))),s.end()}},o.send(e.body)}function s(e,t){var r=new u(0,"dispatch() has not yet been implemented for nodejs");t.reject(r),r.end()}function a(e){m=e}function u(e,t){Link.EventEmitter.call(this),this.status=e,this.reason=t,this.headers={},this.body=null,this.isConnOpen=!0}function l(e,t){Link.EventEmitter.call(this),this.resPromise=e,this.isStreaming=t,this.clientResponse=new u}function c(e,t,r){var n=Link.parseUri(e);if(n.protocol&&"httpl"!==n.protocol)throw"registerLocal can only add servers to the httpl protocol";if(!n.host)throw"invalid domain provided to registerLocal";if(d[n.host])throw"server already registered at domain given to registerLocal";d[n.host]={fn:t,context:r}}function p(e){var t=Link.parseUri(e);if(!t.host)throw"invalid domain provided toun registerLocal";d[t.host]&&delete d[t.host]}function h(e){var t=Link.parseUri(e);if(!t.host)throw"invalid domain provided toun registerLocal";return d[t.host]}function f(){return d}var d={},m=null,v="undefined"!=typeof window?window.location.pathname.split("/"):[""];v[v.length-1]="",v=v.join("/"),t.prototype=Error(),u.prototype=Object.create(Link.EventEmitter.prototype),u.prototype.write=function(e,t){if(t||"string"!=typeof e||"string"!=typeof this.body){var r=this.body&&"string"==typeof this.body?this.body.length:0;this.body=e,e="string"==typeof e?e.slice(r):e}else this.body+=e;this.emit("data",e)},u.prototype.end=function(){this.__deserialize(),this.isConnOpen=!1,this.emit("end")},u.prototype.__deserialize=function(){"string"==typeof this.body&&(this.body=Link.contentTypes.deserialize(this.body,this.headers["content-type"]))},l.prototype=Object.create(Link.EventEmitter.prototype),l.prototype.writeHead=function(e,t,r){this.clientResponse.status=e,this.clientResponse.reason=t;for(var n in r)r.hasOwnProperty(n)&&this.setHeader(n,r[n]);this.isStreaming&&this.__fulfillPromise()},l.prototype.setHeader=function(e,t){this.clientResponse.headers[e]=t},l.prototype.getHeader=function(e){return this.clientResponse.headers[e]},l.prototype.removeHeader=function(e){delete this.clientResponse.headers[e]},l.prototype.write=function(e){this.clientResponse.write(e,!1)},l.prototype.end=function(e){e&&this.write(e),this.isStreaming||(this.clientResponse.__deserialize(),this.__fulfillPromise()),this.clientResponse.end(),this.emit("close"),this.removeAllListeners("close"),this.clientResponse.removeAllListeners("data"),this.clientResponse.removeAllListeners("end")},l.prototype.__fulfillPromise=function(){this.clientResponse.status>=200&&400>this.clientResponse.status?this.resPromise.fulfill(this.clientResponse):this.clientResponse.status>=400&&600>this.clientResponse.status?this.resPromise.reject(new t(this.clientResponse)):this.resPromise.reject(new t(this.clientResponse))},l.prototype.writeContinue=noop,l.prototype.addTrailers=noop,l.prototype.sendDate=noop,e.ResponseError=t,e.dispatch=r,e.registerLocal=c,e.unregisterLocal=p,e.getLocal=h,e.getLocalRegistry=f,e.setRequestDispatcher=a,e.ClientResponse=u,e.ServerResponse=l}(Link),function(e){function t(e){if(!e)throw"no options provided to subscribe";if("string"==typeof e&&(e={url:e}),c)return c(e);if(e.urld=e.url?Link.parseUri(e.url):Link.parseUri(Link.joinUrl(e.host,e.path)),!e.urld)throw"no URL or host/path provided to subscribe";return e.urld.protocol||(e.url=window.location.protocol+"//"+window.location.host+e.url,e.urld=Link.parseUri(e.url)),"httpl"==e.urld.protocol?r(e):n(e)}function r(e){var t=new u(Link.dispatch({method:"get",url:"httpl://"+e.urld.authority+e.urld.relative,headers:{accept:"text/event-stream"},stream:!0}));return t}function n(e){return"undefined"!=typeof window?o(e):i(e)}function o(e){var t=(e.urld.protocol||"http")+"://"+e.urld.authority+e.urld.relative;return new l(t)}function i(){throw"subscribe() has not yet been implemented for nodejs"}function s(e){c=e}function a(){Link.EventEmitter.call(this),this.isConnOpen=!0}function u(e){a.call(this);var t=this;e.then(function(e){e.on("data",function(e){t.__emitEvent(e)}),e.on("end",function(){t.close()})},function(e){t.__emitError({event:"error",data:e}),t.close()})}function l(e){a.call(this),this.eventSource=new EventSource(e);var t=this;this.eventSource.onerror=function(e){e.target.readyState==EventSource.CLOSED&&t.close()}}var c=null;a.prototype=Object.create(Link.EventEmitter.prototype),a.prototype.close=function(){this.isConnOpen=!1,this.removeAllListeners()},a.prototype.__emitError=function(e){this.emit("message",e),this.emit("error",e)},a.prototype.__emitEvent=function(e){this.emit("message",e),this.emit(e.event,e)},u.prototype=Object.create(a.prototype),u.prototype.close=function(){this.__emitError({event:"error",data:void 0}),a.prototype.close.call(this)},l.prototype=Object.create(a.prototype),l.prototype.addListener=function(e,t){if(Array.isArray(e))return e.forEach(function(e){this.addListener(e,t)},this),void 0;if(!this._events[e]){var r=this;this.eventSource.addEventListener(e,function(e){var t=e.data;try{t=JSON.parse(t)}catch(n){}r.__emitEvent({event:e.type,data:t})})}Link.EventEmitter.prototype.addListener.call(this,e,t)},l.prototype.on=l.prototype.addListener,l.prototype.close=function(){this.eventSource.close(),this.eventSource.onerror=null,this.eventSource=null,a.prototype.close.call(this)},e.subscribe=t,e.setEventSubscriber=s,e.EventStream=a}(Link),function(e){function t(){return"undefined"!=typeof window?window.location.host:app?app.config.environmentHost:""}function r(e,t,n){this.rel=e,this.relparams=t,this.url=n,this.resolveState=r.UNRESOLVED,this.error=null}function n(e,t){if(this.context=e||null,this.parentNavigator=t||null,this.links=null,"string"==typeof this.context)this.context=new r(null,null,e);else if(!t)throw"parentNavigator is required for navigators with relative contexts"}function o(e){return e instanceof n?e:new n(e)}var i=["head","post","put","patch","delete"],s={Json:"application/json",Html:"text/html",Xml:"text/xml",Events:"text/event-stream",Eventstream:"text/event-stream",Plain:"text/plain",Text:"text/plain"},a=["alternate","author","collection","current","describedby","first","index","item","last","latest-version","monitor","monitor-group","next","next-archive","payment","predecessor-version","prev","prev-archive","related","replies","search","self","service","successor-version","up","version-history","via","working-copy","working-copy-of"];r.UNRESOLVED=0,r.RESOLVED=1,r.FAILED=2,r.prototype.isResolved=function(){return this.resolveState===r.RESOLVED},r.prototype.isBad=function(){return this.resolveState>1},r.prototype.isRelative=function(){return!this.url&&!!this.rel},r.prototype.isAbsolute=function(){return!!this.url},r.prototype.getUrl=function(){return this.url},r.prototype.getError=function(){return this.error},r.prototype.getHost=function(){if(!this.host){if(!this.url)return null;var e=Link.parseUri(this.url);this.host=(e.protocol||"http")+"://"+(e.authority||t())}return this.host},r.prototype.resetResolvedState=function(){this.resolveState=r.UNRESOLVED,this.error=null},r.prototype.resolve=function(e){this.error=null,this.resolveState=r.RESOLVED,this.url=e;var t=Link.parseUri(this.url);this.host=(t.protocol||"http")+"://"+t.authority},n.prototype.dispatch=function(e){if(!e||!e.method)throw"request options not provided";var t=this,n=Local.promise();return(e.noresolve?Local.promise(this.context.getUrl()):this.resolve({retry:e.retry})).succeed(function(o){e.url=o,Link.dispatch(e).succeed(function(e){return t.context.error=null,t.context.resolveState=r.RESOLVED,t.links=e.headers.link?e.headers.link:t.links||[],e}).fail(function(e){throw 404===e.response.status&&(t.context.error=e,t.context.resolveState=r.FAILED),e}).chain(n)}).fail(function(e){n.reject(e)}),n},n.prototype.subscribe=function(){return this.resolve().succeed(function(e){return Link.subscribe(e)})},n.prototype.relation=function(e,t,o){var i=o||{};return i.title=(t||"").toLowerCase(),new n(new r(e,i),this)},n.prototype.resolve=function(e){var t=this,r=Local.promise();return null!==this.links&&(this.context.isResolved()||this.context.isAbsolute()&&this.context.isBad()===!1)?r.fulfill(this.context.getUrl()):this.context.isBad()===!1||this.context.isBad()&&e.retry?(this.context.resetResolvedState(),this.parentNavigator?this.parentNavigator.__resolveChild(this,e).then(function(e){var r=Local.promise();return t.head(null,null,null,{noresolve:!0}).then(function(){r.fulfill(e)},function(e){r.reject(e)}),r}).chain(r):this.head(null,null,null,{noresolve:!0}).then(function(){return t.context.getUrl()}).chain(r)):r.reject(this.context.getError()),r},n.prototype.__resolveChild=function(e,t){var n=this,o=Local.promise();return this.resolve(t).then(function(){var t=n.__lookupLink(e.context);t?(e.context.resolve(t),o.fulfill(t)):o.reject(new Link.ResponseError({status:404,reason:"link relation not found"}))},function(t){return e.context.error=t,e.context.resolveState=r.FAILED,o.reject(t),t}),o},n.prototype.__lookupLink=function(e){var t=Link.lookupLink(this.links,e.rel,e.relparams.title);if(t){var r=Link.UriTemplate.parse(t).expand(e.relparams),n=Link.parseUri(r);return n.host||(r=this.context.getHost()+n.relative),r}return console.log("Failed to find a link to resolve context. Target link:",e.rel,e.relparams,"Navigator:",this),null},i.forEach(function(e){n.prototype[e]=function(t,r,n,o){var i=o||{};return i.headers=n||{},i.method=e,null!==t&&"null"!=typeof t&&/head/i.test(e)===!1&&(i.headers["content-type"]=r||("object"==typeof t?"application/json":"text/plain")),i.body=t,this.dispatch(i)}}),n.prototype.get=function(e,t,r){var n=r||{};return n.headers=t||{},n.method="get",n.headers.accept=e,this.dispatch(n)};for(var u in s)(function(e,t){n.prototype["get"+e]=function(e,r){return this.get(t,e,r)}})(u,s[u]);a.forEach(function(e){var t=e.replace(/-/g,"_");n.prototype[t]=function(t,r){return this.relation(e,t,r)}}),e.navigator=o,e.Navigator=n}(Link),function(e){"use strict";function t(e){return"[object Array]"===Object.prototype.toString.apply(e)}function r(e,t,r){var n,o=r;for(n in e)e.hasOwnProperty(n)&&(o=t(o,e[n],n,e));return o}function n(e,t,r){var n,o=r;for(n=0;e.length>n;n+=1)o=t(o,e[n],n,e);return o}function o(e,o,i){return t(e)?n(e,o,i):r(e,o,i)}function i(e){var r,n;if(null===e||void 0===e)return!1;if(t(e)){for(r=0;e.length>r;r+=1)if(i(e[r]))return!0;return!1}if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return!0;for(n in e)if(e.hasOwnProperty(n)&&i(e[n]))return!0;return!1}function s(e){return e>="a"&&"z">=e||e>="A"&&"Z">=e}function a(e){return e>="0"&&"9">=e}function u(e){return a(e)||e>="a"&&"f">=e||e>="A"&&"F">=e}function l(e){return s(e)||a(e)||"_"===e||b.isPctEncoded(e)}function c(e){return s(e)||a(e)||"-"===e||"."===e||"_"===e||"~"===e}function p(e){return":"===e||"/"===e||"?"===e||"#"===e||"["===e||"]"===e||"@"===e||"!"===e||"$"===e||"&"===e||"("===e||")"===e||"*"===e||"+"===e||","===e||";"===e||"="===e||"'"===e}function h(e,t){var r,n="",o="";for(("number"==typeof e||"boolean"==typeof e)&&(e=""+e),r=0;e.length>r;r+=o.length)o=b.pctCharAt(e,r),n+=o.length>1?o:c(o)||t&&p(o)?o:b.encodeCharacter(o);return n}function f(e){return h(e,!0)}function d(e,t){this.templateText=e,this.expressions=t}function m(e){var t,r="",n="";for(t=0;e.length>t;t+=n.length)n=b.pctCharAt(e,t),r+=n.length>0?n:p(n)||c(n)?n:b.encodeCharacter(n);return r}function v(e){this.literal=m(e)}function y(e,t,r){this.templateText=e,this.operator=t,this.varspecs=r}function g(e){function t(){c={varname:n.substring(p,i),exploded:!1,maxLength:null},p=null}function r(){if(h===i)throw Error("after a ':' you have to specify the length. position = "+i);c.maxLength=parseInt(n.substring(h,i),10),h=null}var n,o,i,s,u=[],c=null,p=null,h=null;for(n=e.substr(1,e.length-2),i=0;n.length>i;i+=s.length){if(s=b.pctCharAt(n,i),0===i){if(o=w.valueOf(s),""!==o.symbol){p=1;continue}p=0}if(null!==p){if("."===s){if(p===i)throw Error("a varname MUST NOT start with a dot -- see position "+i);continue}if(l(s))continue;t()}if(null!==h){if(a(s))continue;r()}if(":"!==s)if("*"!==s){if(","!==s)throw Error("illegal character '"+s+"' at position "+i);u.push(c),c=null,p=i+1}else{if(null===c)throw Error("explode exploded at position "+i);if(c.exploded)throw Error("explode exploded twice at position "+i);if(c.maxLength)throw Error("an explode (*) MUST NOT follow to a prefix, see position "+i);c.exploded=!0}else{if(null!==c.maxLength)throw Error("only one :maxLength is allowed per varspec at position "+i);h=i+1}}return null!==p&&t(),null!==h&&r(),u.push(c),new y(e,o,u)}var b=function(){function e(e){return unescape(encodeURIComponent(e))}function t(t){var r,n,o="",i=e(t);for(n=0;i.length>n;n+=1)r=i.charCodeAt(n),o+="%"+r.toString(16).toUpperCase();return o}function r(e){if(3>e.length)return!1;for(var t=0;e.length>t;t+=3)if("%"!==e.charAt(t)||!u(e.charAt(t+1)||!u(e.charAt(t+2))))return!1;return!0}function n(e,t){var n=e.charAt(t);return"%"!==n?n:(n=e.substr(t,3),r(n)?n:"%")}return{encodeCharacter:t,decodeCharacter:decodeURIComponent,isPctEncoded:r,pctCharAt:n}}(),w=function(){function e(e){t[e]={symbol:e,separator:"?"===e?"&":""===e||"+"===e||"#"===e?",":e,named:";"===e||"&"===e||"?"===e,ifEmpty:"&"===e||"?"===e?"=":"",first:"+"===e?"":e,encode:"+"===e||"#"===e?f:h,toString:function(){return this.symbol}}}var t={};return e(""),e("+"),e("#"),e("."),e("/"),e(";"),e("?"),e("&"),{valueOf:function(e){if(t[e])return t[e];if("=,!@|".indexOf(e)>=0)throw Error('Illegal use of reserved operator "'+e+'"');return t[""]}}}();d.prototype.toString=function(){return this.templateText},d.prototype.expand=function(e){var t,r="";for(t=0;this.expressions.length>t;t+=1)r+=this.expressions[t].expand(e);return r},v.prototype.expand=function(){return this.literal},v.prototype.toString=v.prototype.expand,y.prototype.toString=function(){return this.templateText},y.prototype.expand=function(e){function r(e,t,r){return i(t)&&(e.length>0&&(e+=","),c||(e+=f.encode(r)+","),e+=f.encode(t)),e}function n(e,t,r){return i(t)&&(e.length>0&&(e+=f.separator),e+=c?m(u.varname):f.encode(r),e+="="+f.encode(t)),e}function s(e,t,r){return i(t)&&(e.length>0&&(e+=f.separator),c||(e+=f.encode(r)+"="),e+=f.encode(t)),e}var a,u,l,c,p="",h=!0,f=this.operator;for(a=0;this.varspecs.length>a;a+=1)if(u=this.varspecs[a],l=e[u.varname],i(l))if(h?(p+=this.operator.first,h=!1):p+=this.operator.separator,c=t(l),"string"==typeof l||"number"==typeof l||"boolean"==typeof l){if(l=""+l,this.operator.named){if(p+=m(u.varname),""===l){p+=this.operator.ifEmpty;continue}p+="="}u.maxLength&&l.length>u.maxLength&&(l=l.substr(0,u.maxLength)),p+=this.operator.encode(l)}else{if(u.maxLength)throw Error("Prefix modifiers are not applicable to variables that have composite values. You tried to expand "+this+" with "+JSON.stringify(l));if(u.exploded)p+=o(l,f.named?n:s,"");else{if(f.named){if(p+=m(u.varname),!i(l)){p+=this.operator.ifEmpty;continue}p+="="}p+=o(l,r,"")}}return p},d.parse=function(e){var t,r,n=[],o=null,i=0;for(t=0;e.length>t;t+=1)if(r=e.charAt(t),null===i){if(null===o)throw Error("reached unreachable code");if("{"===r)throw Error("brace was opened in position "+o+" and cannot be reopened in position "+t);if("}"===r){if(o+1===t)throw Error("empty braces on position "+o);n.push(g(e.substring(o,t+1))),o=null,i=t+1}}else{if("}"===r)throw Error("brace was closed in position "+t+" but never opened");"{"===r&&(t>i&&n.push(new v(e.substring(i,t))),i=null,o=t)}if(null!==o)throw Error("brace was opened on position "+o+", but never closed");return e.length>i&&n.push(new v(e.substr(i))),new d(e,n)},e.UriTemplate=d}(Link),"undefined"!=typeof module?module.exports=Link:"undefined"!=typeof define&&define([],function(){return Link}),function(e){function t(){this.streams=[]}function r(){return new t}t.prototype.addStream=function(e){this.streams.push(e)},t.prototype.endStream=function(e){this.streams=this.streams.filter(function(t){return t!=e}),e.end()},t.prototype.endAllStreams=function(){this.streams.forEach(function(e){e.end()}),this.streams.length=0},t.prototype.emit=function(e,t){this.streams.forEach(function(r){this.emitTo(r,e,t)},this)},t.prototype.emitTo=function(e,t,r){e.write({event:t,data:r})},e.Broadcaster=t,e.broadcaster=r}(Link),function(e){function t(e){this.response=e}function r(e){return e instanceof t?e:new t(e)}var n={processing:[102,"server has received and is processing the request"],ok:[200,"ok"],created:[201,"request has been fulfilled; new resource created"],accepted:[202,"request accepted, processing pending"],shouldBeOk:[203,"request processed, information may be from another source"],nonauthInfo:[203,"request processed, information may be from another source"],noContent:[204,"request processed, no content returned"],resetContent:[205,"request processed, no content returned, reset document view"],partialContent:[206,"partial resource return due to request header"],multipleChoices:[300,"multiple options for the resource delivered"],movedPermanently:[301,"this and all future requests directed to the given URI"],found:[302,"response to request found via alternative URI"],seeOther:[303,"response to request found via alternative URI"],notModified:[304,"resource has not been modified since last requested"],useProxy:[305,"content located elsewhere, retrieve from there"],switchProxy:[306,"subsequent requests should use the specified proxy"],temporaryRedirect:[307,"connect again to different uri as provided"],badRequest:[400,"request cannot be fulfilled due to bad syntax"],unauthorized:[401,"authentication is possible but has failed"],forbidden:[403,"server refuses to respond to request"],notFound:[404,"requested resource could not be found"],methodNotAllowed:[405,"request method not supported by that resource"],notAcceptable:[406,"content not acceptable according to the Accept headers"],conflict:[409,"request could not be processed because of conflict"],gone:[410,"resource is no longer available and will not be available again"],preconditionFailed:[412,"server does not meet request preconditions"],unsupportedMediaType:[415,"server does not support media type"],teapot:[418,"I'm a teapot"],enhanceYourCalm:[420,"rate limit exceeded"],unprocessableEntity:[422,"request unable to be followed due to semantic errors"],locked:[423,"resource that is being accessed is locked"],failedDependency:[424,"request failed due to failure of a previous request"],internalServerError:[500,"internal server error"],serverError:[500,"internal server error"],notImplemented:[501,"server does not recognise method or lacks ability to fulfill"],badGateway:[502,"server received an invalid response from upstream server"],serviceUnavailable:[503,"server is currently unavailable"],unavailable:[503,"server is currently unavailable"],gatewayTimeout:[504,"gateway did not receive response from upstream server"],insufficientStorage:[507,"server is unable to store the representation"],notExtended:[510,"further extensions to the request are required"]},o={text:"text/plain",plain:"text/plain",json:"application/json",html:"text/html",xml:"text/xml","events-stream":"text/event-stream"};t.prototype.respond=function(e,t,r){var n;return Array.isArray(e)&&(n=e[1],e=e[0]),r=r||{},t&&(r["content-type"]=o[t]||t),this.response.writeHead(e,n,r),this.response};for(var i in n)(function(e){t.prototype[i]=function(t,r){return this.respond(e,t,r)}})(n[i]);t.prototype.pipe=function(e,t,r){t=t||function(e){return e},r=r||function(e){return e};var n=this,o=Local.promise(e);return o.succeed(function(e){return n.response.status||n.response.writeHead(e.status,e.reason,t(e.headers)),null!==e.body&&e.body!==void 0&&n.response.write(r(e.body)),e.on?(e.on("data",function(e){n.response.write(r(e))}),e.on("end",function(){n.response.end()})):n.response.end(),e}).fail(function(e){console.log("response piping error from upstream:",e);var t=e.response.headers["content-type"]||"text/plain",r=t&&e.response.body?e.response.body:"";throw n.badGateway(t).end(r),e}),o},t.prototype.cb=function(e,t,r,n){var o=this[e],i=this;return function(e){return o.call(i,t,r).end(n),e}},t.setTypeAlias=function(e,t){o[e]=t},e.Responder=t,e.responder=r}(Link),function(e){function t(e){return-1===l.indexOf(e)}function r(e,r){return t(r)?e.headers?e.headers[r]:null:e[r]}function n(e,t){return-1!==e.indexOf(t)}function o(e){return e instanceof RegExp?e:Array.isArray(e)?RegExp("^"+e.join("|")+"$","gi"):RegExp("^"+e+"$","gi")}function i(e){this.request=e,this.isRouted=!1,this.bestMatch=[]}function s(e){return e instanceof i?e:new i(e)}var a=["p","pm","pma","pmat","pmta","pmt","pa","pt","m","ma","mat","mta","mt","mp","mpa","mpt","mpat","mpta","a","at","t"],u={p:"path",m:"method",a:"accept",t:"content-type"},l=["path","method","query","body","stream"];
i.prototype.route=function(e,t){if("function"!=typeof t)throw Error("a handler callback must be given to the route");if(this.isRouted)return this;var o,i,s,a={},u=[],l=!0;for(var c in e)s=e[c],i=r(this.request,c),"path"==c&&"/"!=i.charAt(0)&&(i="/"+i),o=s.exec(i),null!==o&&o!==!1?(a[c]=o,u.push(c)):(l=!1,(n(u,"path")||n(u,"method"))&&u.length>this.bestMatch.length&&(this.bestMatch=u));return l&&(t.call(this,a),this.isRouted=!0),this},i.prototype.error=function(e,t){if(this.isRouted)return this;var r=Link.responder(e),o=this.bestMatch.concat(t);n(o,"path")?n(o,"method")?!n(o,"content-type")&&this.request.body?r.unsupportedMediaType().end():!n(o,"accept")&&this.request.headers.accept?r.notAcceptable().end():r.badRequest().end():r.methodNotAllowed().end():r.notFound().end()},a.forEach(function(e){var t=e.split("").map(function(e){return u[e]});i.prototype[e]=function(){var e={},r=0;for(r;t.length>r;r++){var n=t[r];e[n]=o(arguments[r])}var i=arguments[r];return this.route(e,i)}}),i.setTypeAlias=function(e,t){typeAliases[e]=t},e.Router=i,e.router=s}(Link);var MyHouse={};(function(e){function t(){return s++}function r(e,t){t=t||{},this.isLogging=t.log,this.messageListeners={},this.replyCbs={},this.messageBuffers={},e&&this.onMessage("ready",e,this),this.worker=new Worker(t.bootstrapUrl||"worker-bootstrap.js"),n.call(this)}function n(){var e=this;this.worker.addEventListener("message",function(t){var r=t.data;if(this.isLogging&&console.log("receiving",r),"reply"===r.name){var n=e.replyCbs[r.reply_to];if(n)return n.func.call(n.context,r),delete e.replyCbs[r.reply_to],void 0}var o=e.messageListeners[r.name];if("endMessage"===r.name){var i=r.data;o=e.messageListeners[i],e.removeAllMessageListeners(i)}o&&o.forEach(function(e){e.func.call(e.context,r)})})}function o(e,r,n){var o={id:t(),reply_to:n,name:e,data:r};return o}function i(e,t,r){e.name in this.messageBuffers?this.messageBuffers[e.name].push([e,t,r]):(t&&"function"==typeof t&&(this.replyCbs[e.id]={func:t,context:r}),this.isLogging&&console.log("sending",e),this.worker.postMessage(e))}var s=1;r.prototype.postMessage=function(e,t,r,n){var s=o(e,t);return i.call(this,s,r,n),s.id},r.prototype.postReply=function(e,t,r,n){var s="object"==typeof e?e.id:e,a=o("reply",t,s);return i.call(this,a,r,n),a.id},r.prototype.endMessage=function(e){return this.postMessage("endMessage",e)},r.prototype.addMessageListener=function(e,t,r){e in this.messageListeners||(this.messageListeners[e]=[]),this.messageListeners[e].push({func:t,context:r})},r.prototype.onMessage=r.prototype.addMessageListener,r.prototype.removeMessageListener=function(e,t){if(e in this.messageListeners){var r=function(e){return e.func!=t};this.messageListeners[e]=this.messageListeners[e].filter(r),0===this.messageListeners[e].length&&delete this.messageListeners[e]}},r.prototype.removeAllMessageListeners=function(e){e in this.messageListeners&&delete this.messageListeners[e]},r.prototype.bufferMessages=function(e){e in this.messageBuffers||(this.messageBuffers[e]=[])},r.prototype.releaseMessages=function(e){if(e in this.messageBuffers){var t=this.messageBuffers[e];delete this.messageBuffers[e],t.forEach(function(e){i.apply(this,e)},this)}},r.prototype.nullify=function(e){this.postMessage("nullify",e)},r.prototype.importScripts=function(e,t){this.postMessage("importScripts",e,t)},r.prototype.terminate=function(){var e;for(e in this.messageListeners)delete this.messageListeners[e];for(e in this.replyCbs)delete this.replyCbs[e];this.worker.terminate(),this.worker=null},e.Sandbox=r})(MyHouse),"undefined"!=typeof module?module.exports=MyHouse:"undefined"!=typeof define&&define([],function(){return MyHouse});var CommonClient={};(function(e){function t(e,t){if(!(e&&e instanceof Element))throw"Listen() requires a valid DOM element as a first parameter";e.__eventHandlers=[],t=t||{};var r;t.links!==!1&&(r={handleEvent:n,container:e},e.addEventListener("click",r),e.__eventHandlers.push(r)),t.forms!==!1&&(r={handleEvent:o,container:e},e.addEventListener("submit",r)),t.dragdrops!==!1&&(r={handleEvent:i,container:e},e.addEventListener("dragstart",r),e.__eventHandlers.push(r))}function r(e){e.__eventHandlers&&(e.__eventHandlers.forEach(function(t){e.removeEventListener(t)}),delete e.__eventHandlers);var t=e.querySelectorAll("[data-subscribe]");Array.prototype.forEach.call(t,function(e){if(e.__subscriptions){for(var t in e.__subscriptions)e.__subscriptions[t].close();delete e.__subscriptions}})}function n(e){if(0===e.button){y(e.target);var t=g.fromAnchor(e.target);if(!t||-1===["_top","_blank"].indexOf(t.target))return t?(e.preventDefault(),e.stopPropagation(),v(e.target,t),!1):void 0}}function o(e){var t=g(e.target,this.container);if(!t||-1===["_top","_blank"].indexOf(t.target))return t?(e.preventDefault(),e.stopPropagation(),v(e.target,t),!1):void 0}function i(e){e.dataTransfer.effectAllowed="none";var t=null,r=e.target;y(r),"A"==r.tagName?t=g.fromAnchor(r):r.form&&(t=g(r.form,this.container)),t&&(e.dataTransfer.effectAllowed="link",e.dataTransfer.setData("application/request+json",JSON.stringify(t)),e.dataTransfer.setData("text/uri-list",t.url),e.dataTransfer.setData("text/plain",t.url))}function s(e,t,r){switch(r.headers=r.headers||{},r.status){case 204:break;case 205:"FORM"===e.tagName&&e.reset();break;case 303:var n={method:"get",url:r.headers.location,headers:{accept:"text/html"}};v(e,n);break;default:a(e,t,r)}}function a(e,t,r){if(r.body){var n=r.headers["content-type"];if(/application\/html\-deltas\+json/.test(n))if("object"!=typeof r.body)console.log("Improperly-formed application/html-deltas+json object",r);else for(var o in r.body)u(o,r.body[o],e,t);else{var i="";i=/text\/html/.test(n)?""+r.body:"string"==typeof r.body?r.body.replace(/</g,"&lt;").replace(/>/g,"&gt;"):JSON.stringify(r.body),e.innerHTML=i}}l(e,t),p(e,t)}function u(e,t,r,n){if("object"==typeof t)for(var o in t){var i,s,a=n.querySelectorAll(o),u=function(e){a[i].classList.add(e)},l=function(e){a[i].classList.remove(e)},c=function(e){a[i].classList.toggle(e)};for(i=0,s=a.length;s>i;i++)if(a[i])switch(e){case"replace":a[i].innerHTML=t[o];break;case"append":a[i].innerHTML=a[i].innerHTML+t[o];break;case"prepend":a[i].innerHTML=t[o]+a[i].innerHTML;break;case"addClass":a[i].classList&&t[o].split(" ").forEach(u);break;case"removeClass":a[i].classList&&t[o].split(" ").forEach(l);break;case"toggleClass":a[i].classList&&t[o].split(" ").forEach(c)}}}function l(e,t){w.forEach(function(r){var n="on"+r,o=e.querySelectorAll("["+n+"]");Array.prototype.forEach.call(o,function(e){var o=e.getAttribute(n);e.addEventListener(r,c(o,t)),e.removeAttribute(n)})})}function c(e,t){return function(r){return request=g(r.currentTarget,t),request.method=e,/GET/i.test(e)!==!1||request.body||(request.body=request.query,delete request.query),request?(r.preventDefault(),r.stopPropagation(),v(r.target,request),!1):void 0}}function p(e){var t=e.querySelectorAll("[data-subscribe]");Array.prototype.forEach.call(t,function(e){var t=e.dataset.subscribe;e.__subscriptions=e.__subscriptions||{};var r=e.__subscriptions[t];r||(r=e.__subscriptions[t]=Link.subscribe({url:t})),r.on("update",h(t,e)),r.on("error",f())})}function h(e,t){return function(){var r={method:"get",url:e,target:"_element",headers:{accept:"text/html"}};v(t,r)}}function f(){return function(e){var t=e.data;console.log("Client update stream error:",t)}}function d(e,t){for(;e;){if(t(e))return e;e=e.parentNode}return null}function m(){for(var e,t=Array.prototype.slice.call(arguments),r={};t.length;)if(e=t.shift())for(var n in e)e[n]&&(r[n]="object"!=typeof e[n]||Array.isArray(e[n])?e[n]:m(r[n],e[n]));return r}function v(e,t){var r=new CustomEvent("request",{bubbles:!0,cancelable:!0,detail:t});e.dispatchEvent(r)}function y(e){var t=d.thatisFormRelated(e);if(t){for(var r=0;t.form.length>r;r++)t.form[r].setAttribute("submitter",null);t.setAttribute("submitter","1")}}function g(e,t){var r={form:{},fieldset:{},elem:{}},n=null,o=null;if("FIELDSET"===e.tagName?n=e:"FORM"!==e.tagName&&(n=d.byTag(e,"FIELDSET")),"FORM"===e.tagName)o=e;else{var i=e.getAttribute("form")||(n?n.getAttribute("form"):null);i&&(o=t.querySelector("#"+i)),o||(o=d.byTag(e,"FORM"))}var s=b(e,o);o&&(r.form=g.fromForm(o,e)),n&&(r.fieldset=g.fromFormElement(n)),"A"===e.tagName?r.elem=g.fromAnchor(e):-1===["FORM","FIELDSET"].indexOf(e.tagName)&&(r.elem=g.fromFormElement(e));var a=m(r.form,r.fieldset,r.elem),u={};return u[/GET/i.test(a.method)?"query":"body"]=s,m(a,u)}function b(e,t){for(var r={},n=0;t.length>n;n++){var o=t[n];if(d.byElement(o,e)){var i="1"==o.getAttribute("submitter");if("BUTTON"===o.tagName)i&&(r[o.name]=o.value);else if("INPUT"===o.tagName)switch(o.type.toLowerCase()){case"button":case"submit":i&&(r[o.name]=o.value);break;case"checkbox":o.checked&&(r[o.name]=(r[o.name]||[]).concat(o.value));break;case"radio":null!==o.getAttribute("checked")&&(r[o.name]=o.value);break;default:r[o.name]=o.value}else r[o.name]=o.value}}return r}e.listen=t,e.unlisten=r,e.handleResponse=s;var w=["blur","change","click","dblclick","focus","keydown","keypress","keyup","load","mousedown","mousemove","mouseout","mouseover","mouseup","reset","select","submit","unload"];d.byTag=function(e,t){return d(e,function(e){return e.tagName==t})},d.byClass=function(e,t){return d(e,function(e){return e.classList&&e.classList.contains(t)})},d.byElement=function(e,t){return d(e,function(e){return e===t})},d.thatisFormRelated=function(e){return d(e,function(e){return!!e.form})},g.fromAnchor=function(e){if(e=d.byTag(e,"A"),!e)return null;var t={method:"get",url:e.attributes.href.value,target:e.getAttribute("target"),headers:{accept:e.getAttribute("type")}};return t},g.fromFormElement=function(e){var t={method:e.getAttribute("formmethod"),url:e.getAttribute("formaction"),target:e.getAttribute("formtarget"),headers:{"content-type":e.getAttribute("formenctype")}};return t},g.fromForm=function(e,t){if(t&&!t.form)for(var r=0;e.length>r;r++){var n=e[r];if("1"==n.getAttribute("submitter")){t=n,n.setAttribute("submitter","0");break}}var o={submitter:{},form:{}};t&&(o.submitter={method:t.getAttribute("formmethod"),url:t.getAttribute("formaction"),target:t.getAttribute("formtarget"),headers:{"content-type":t.getAttribute("formenctype")}}),o.form={method:e.getAttribute("method"),url:e.getAttribute("action"),target:e.getAttribute("target"),headers:{"content-type":e.getAttribute("enctype")||e.enctype}},e.acceptCharset&&(o.form.headers.accept=e.acceptCharset);var i=m(o.form,o.submitter);return i},e.findParentNode=d,e.extractRequest=g})(CommonClient),"undefined"!=typeof module?module.exports=CommonClient:"undefined"!=typeof define&&define([],function(){return CommonClient});var Environment={};(function(e){function t(){return o++}function r(){this.config={id:t(),domain:null},this.state=r.BOOT,this.environment=null}function n(e,t){if(r.call(this),e)for(var n in e)this.config[n]=e[n];this.config.domain||(this.config.domain=this.config.scriptUrl?"<"+this.config.scriptUrl+">":"{"+this.config.script.slice(0,20)+"}"),this.config.environmentHost=window.location.host,this.loaderrorCb=t,this.readyMessage=null,this.canLoadUserscript=!1,this.worker=new MyHouse.Sandbox(null,{bootstrapUrl:Environment.config.workerBootstrapUrl}),this.worker.bufferMessages("httpRequest"),this.worker.onMessage("ready",this.onWorkerReady,this),this.worker.onMessage("terminate",this.terminate,this),this.worker.onMessage("httpRequest",this.onWorkerHttpRequest,this),this.worker.onMessage("httpSubscribe",this.onWorkerHttpSubscribe,this),this.worker.onMessage("log",this.onWorkerLog,this)}var o=1;r.BOOT=0,r.READY=1,r.ACTIVE=2,r.DEAD=3,r.prototype.handleHttpRequest=function(e,t){t.writeHead(0,"server not implemented"),t.end()},r.prototype.terminate=function(){this.state=r.DEAD},r.prototype.getSource=function(){return""+this.handleHttpRequest},n.prototype=Object.create(r.prototype),n.prototype.onWorkerReady=function(e){this.worker.nullify("XMLHttpRequest"),this.worker.nullify("Worker"),this.state=r.READY,this.readyMessage=e,this.canLoadUserscript&&this.loadUserScript()},n.prototype.loadUserScript=function(){if(this.canLoadUserscript=!0,this.state==r.READY){this.worker.postReply(this.readyMessage,this.config);var e=this.config.scriptUrl;if(!e&&this.config.script){var t=new Blob([this.config.script],{type:"application/javascript"});e=(window.webkitURL?webkitURL:URL).createObjectURL(t)}var n=this;this.worker.importScripts(e,function(e){return e.data.error?(n.loaderrorCb&&n.loaderrorCb(e.data),n.terminate(),void 0):(n.state!=r.DEAD&&(n.state=r.ACTIVE,n.worker.releaseMessages("httpRequest")),void 0)})}},n.prototype.terminate=function(){this.state=r.DEAD,this.worker.terminate()},n.prototype.getSource=function(e){var t=this.config.scriptUrl;if(t){var r=Local.promise();/\/\//.test(t)===!1&&(t="http://"+window.location.host+t);var n={method:"get",url:t,headers:{accept:"application/javascript"}};return Link.dispatch(n,e).then(function(e){e.on("end",function(){r.fulfill(e.body)})},function(e){console.log("failed to retrieve worker source:",e.message,e.response),r.reject(e)}),r}return this.config.script},n.prototype.onWorkerLog=function(e){console.log("["+this.config.domain+"]",e.data)},n.prototype.onWorkerHttpRequest=function(e){var t=this;e.data;var r=function(r){var n=t.worker.postReply(e,r);r.on("data",function(e){t.worker.postMessage(n,e)}),r.on("end",function(){t.worker.endMessage(n)})},n=function(r){var n=t.worker.postReply(e,r.response);t.worker.endMessage(n)};Local.promise(Link.dispatch(e.data,this)).then(r,n)},n.prototype.onWorkerHttpSubscribe=function(e){var t=this,r=e.data,n=Link.subscribe(r);this.worker.onMessage(e.id,function(e){var r=e.data,o=t.worker.postReply(e);n.on(r,function(e){t.worker.postMessage(o,e)})})},n.prototype.handleHttpRequest=function(e,t){this.worker.postMessage("httpRequest",e,function(e){if(!e.data)throw"Invalid httpRequest reply to document from worker";t.writeHead(e.data.status,e.data.reason,e.data.headers),e.data.body!==void 0&&null!==e.data.body&&t.write(e.data.body),this.worker.onMessage(e.id,function(e){"endMessage"===e.name?t.end():t.write(e.data)})},this)},e.Server=r,e.WorkerServer=n})(Environment),function(e){function t(e){if(this.id=e,this.context={url:"",urld:{},links:[],type:""},this.element=document.getElementById(e),!this.element)throw"ClientRegion target element not found";this.element.addEventListener("request",r.bind(this)),CommonClient.listen(this.element)}function r(e){e.preventDefault(),e.stopPropagation();var t=e.detail,r=this;this.__prepareRequest(t),Local.promise(Link.dispatch(t,this)).then(function(n){r.__handleResponse(e,t,n)},function(n){r.__handleResponse(e,t,n.response)})}t.prototype.dispatchRequest=function(e){"string"==typeof e&&(e={method:"get",url:e,headers:{accept:"text/html"}});var t=new CustomEvent("request",{bubbles:!0,cancelable:!0,detail:e});this.element.dispatchEvent(t)},t.prototype.terminate=function(){CommonClient.unlisten(this.element),this.element.removeEventListener("request",this.listenerFn)},t.prototype.__prepareRequest=function(e){e.headers=e.headers||{},e.headers.accept=e.headers.accept||"text/html",e.stream=!1;var t=Link.parseUri(e);if(!t.protocol){var r;r=e.url.length>0&&"/"!=e.url.charAt(0)?this.context.urld.protocol+"://"+this.context.urld.host+this.context.urld.directory+e.url:this.context.urld.protocol+"://"+this.context.urld.host+e.url;var n=this.context.urld.host;do e.url=r,r=e.url.replace(/[^\/]+\/\.\.\//i,"");while(r!=e.url&&Link.parseUri(r).host==n);delete e.host,delete e.path}},t.prototype.__updateContext=function(e,t){var r=Link.parseUri(e);this.context.urld=r,this.context.url=r.protocol+"://"+r.authority+r.directory,this.context.links=t.headers.link,this.context.type=t.headers["content-type"]},t.prototype.__handleResponse=function(e,t,r){var n=this.__chooseRequestTarget(e,t),o=Environment.getClientRegion(n.id);o&&o.__updateContext(t,r),CommonClient.handleResponse(n,this.element,r),Environment.postProcessRegion(n)},t.prototype.__chooseRequestTarget=function(e,t){return"_element"==t.target?e.target:document.getElementById(t.target)||this.element},e.ClientRegion=t}(Environment),function(e){e.config={workerBootstrapUrl:"lib/worker-server.min.js"},e.servers={},e.clientRegions={},e.numServers=0,e.numClientRegions=0,e.addServer=function(e,t){return t.environment=this,t.config.domain=e,Environment.servers[e]=t,Environment.numServers++,t.loadUserScript&&t.loadUserScript(),Link.registerLocal(e,t.handleHttpRequest,t),t},e.killServer=function(e){var t=Environment.servers[e];t&&(Link.unregisterLocal(e),t.terminate(),delete Environment.servers[e],Environment.numServers--)},e.getServer=function(e){return Environment.servers[e]},e.listFilteredServers=function(e){var t={};for(var r in Environment.servers)e(Environment.servers[r],r)&&(t[r]=Environment.servers[r]);return t},e.addClientRegion=function(e){var t;return"object"==typeof e?t=e.id:(t=e,e=new Environment.ClientRegion(t)),Environment.clientRegions[e.id]=e,Environment.numClientRegions++,e},e.removeClientRegion=function(e){Environment.clientRegions[e]&&(Environment.clientRegions[e].terminate(),delete Environment.clientRegions[e],Environment.numClientRegions--)},e.getClientRegion=function(e){return Environment.clientRegions[e]};var t,r=Link.dispatch;Link.dispatch=function(e,n){var o=t.call(this,e,n,r);if(o instanceof Local.Promise)return o;if(o){if(!(o instanceof Link.ClientResponse))if("object"==typeof o){var i=new Link.ClientResponse(o.status,o.reason);i.headers=o.headers,i.end(o.body),o=i}else o=new Link.ClientResponse(0,""+o)}else o=new Link.ClientResponse(0,"Environment did not correctly dispatch the request");var s=Local.promise();return o.status>=400?s.reject(o):s.fulfill(o),s},t=function(e,t,r){return r(e)},e.setDispatchWrapper=function(e){t=e},e.postProcessRegion=function(e){return this.__postProcessRegion(e)},e.__postProcessRegion=function(){},e.setRegionPostProcessor=function(e){this.__postProcessRegion=e}}(Environment),"undefined"!=typeof module?module.exports=App:"undefined"!=typeof define&&define([],function(){return App});